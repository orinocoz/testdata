Fri Dec 12 12:08:48 PM EET 2025
+ hostname
angaar
+ ansible-playbook infra.yaml --diff

PLAY [Gather facts from all hosts] *********************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [init : Update APT cache] *************************************************
changed: [orinocoz-3]
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [init : Update APT cache] *************************************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [init : Add Grafana APT GPG key] ******************************************
changed: [orinocoz-3]
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [init : Add Grafana APT repository (OSS)] *********************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb https://packages.grafana.com/oss/deb stable main

changed: [orinocoz-3]
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb https://packages.grafana.com/oss/deb stable main

changed: [orinocoz-1]
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb https://packages.grafana.com/oss/deb stable main

changed: [orinocoz-2]

TASK [init : Install Prometheus node] ******************************************
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-3]
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-1]
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-2]

TASK [init : Ensure node_exporter are started and enabled] *********************
ok: [orinocoz-1]
ok: [orinocoz-2]
ok: [orinocoz-3]

TASK [init : Install Promtail] *************************************************
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-1]
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-3]
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-2]

TASK [init : Add Promtail user to adm group] ***********************************
changed: [orinocoz-2]
changed: [orinocoz-3]
changed: [orinocoz-1]

TASK [init : Ensure Promtail state directory exists] ***************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 110,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 110,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 110,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3]

TASK [init : Deploy Promtail configuration] ************************************
--- before: /etc/promtail/config.yml
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpuftcjp8p/promtail.yaml.j2
@@ -1,24 +1,44 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
-  grpc_listen_port: 0
-
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: http://orinocoz-3:3100/loki/api/v1/push
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: haproxy
+    syslog:
+      listen_address: 0.0.0.0:8814
+      labels:
+        job: haproxy
+        hostname: "orinocoz-1"
+  - job_name: syslog_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-1"
+          job: syslog
+          __path__: /var/log/syslog
+  - job_name: nginx_access_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-1"
+          job: nginx_access_logs
+          __path__: /var/log/nginx/access.log
+  - job_name: nginx_error_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-1"
+          job: nginx_error_logs
+          __path__: /var/log/nginx/error.log
+  - job_name: agama_logs_slo
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-1"
+          job: agama_logs_slo
+          service_name: agama
+          __path__: /var/log/nginx/agama.log

changed: [orinocoz-1]
--- before: /etc/promtail/config.yml
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmplam0tn07/promtail.yaml.j2
@@ -1,24 +1,30 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
-  grpc_listen_port: 0
-
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: http://orinocoz-3:3100/loki/api/v1/push
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: syslog_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-3"
+          job: syslog
+          __path__: /var/log/syslog
+  - job_name: nginx_access_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-3"
+          job: nginx_access_logs
+          __path__: /var/log/nginx/access.log
+  - job_name: nginx_error_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-3"
+          job: nginx_error_logs
+          __path__: /var/log/nginx/error.log

changed: [orinocoz-3]
--- before: /etc/promtail/config.yml
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp7gx1oa5u/promtail.yaml.j2
@@ -1,24 +1,44 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
-  grpc_listen_port: 0
-
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: http://orinocoz-3:3100/loki/api/v1/push
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: haproxy
+    syslog:
+      listen_address: 0.0.0.0:8814
+      labels:
+        job: haproxy
+        hostname: "orinocoz-2"
+  - job_name: syslog_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-2"
+          job: syslog
+          __path__: /var/log/syslog
+  - job_name: nginx_access_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-2"
+          job: nginx_access_logs
+          __path__: /var/log/nginx/access.log
+  - job_name: nginx_error_logs
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-2"
+          job: nginx_error_logs
+          __path__: /var/log/nginx/error.log
+  - job_name: agama_logs_slo
+    static_configs:
+      - targets: ['localhost']
+        labels:
+          hostname: "orinocoz-2"
+          job: agama_logs_slo
+          service_name: agama
+          __path__: /var/log/nginx/agama.log

changed: [orinocoz-2]

TASK [init : Ensure Promtail service is started and enabled] *******************
ok: [orinocoz-1]
ok: [orinocoz-3]
ok: [orinocoz-2]

TASK [init : Create a backup user] *********************************************
changed: [orinocoz-1]
changed: [orinocoz-2]
changed: [orinocoz-3]

TASK [init : Ensure backup user .ssh directory exists] *************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [init : Deploy known_hosts for backup user] *******************************
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpin5wv5bj/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.acme.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [orinocoz-3]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp46np1hbs/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.acme.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [orinocoz-1]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp47cf56ut/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.acme.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [orinocoz-2]

TASK [init : Create /home/backup/restore directory] ****************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0700",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0700",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-1]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0700",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-2]

TASK [init : Install Duplicity] ************************************************
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-1]
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-3]
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-2]

TASK [init : Install dnspython for nsupdate] ***********************************
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-3]
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-1]
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 249 not upgraded.
changed: [orinocoz-2]

RUNNING HANDLER [init : Restart Promtail] **************************************
changed: [orinocoz-3]
changed: [orinocoz-1]
changed: [orinocoz-2]

PLAY [DNS server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [bind : Install Bind] *****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-1]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-2]

TASK [bind : Ensure Bind is running and enabled] *******************************
ok: [orinocoz-3]
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [bind : Configure DNS forwarders] *****************************************
--- before: /etc/bind/named.conf.options
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpqe7nd9fo/named.conf.options.j2
@@ -1,24 +1,33 @@
+acl dns_allowed_networks{
+        192.168.42.0/23;
+        127.0.0.0/8;
+        172.17.0.0/16;
+    };
+
+key "transfer.key" {
+    algorithm hmac-sha256;
+    secret "v8eL3F3xynSYvOyuLerg57mP7CXohs3F+VVcP8b9K/0=";
+};
+
+key "nsupdate.key" {
+    algorithm hmac-sha256;
+    secret "/qyKZnlxy1bL2QPS7JJRWVyc4apKNJVaWU7Xgxve7vk=";
+};
+
 options {
-	directory "/var/cache/bind";
+  directory "/var/cache/bind";
+  allow-query {dns_allowed_networks;};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+  forwarders {
+      1.1.1.1;
+      8.8.8.8;
+      9.9.9.9;
+     };
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+  forward first;
+  dnssec-validation no;
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
 };

changed: [orinocoz-1] => (item=options)
--- before: /etc/bind/named.conf.options
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpn9hxoaj_/named.conf.options.j2
@@ -1,24 +1,33 @@
+acl dns_allowed_networks{
+        192.168.42.0/23;
+        127.0.0.0/8;
+        172.17.0.0/16;
+    };
+
+key "transfer.key" {
+    algorithm hmac-sha256;
+    secret "v8eL3F3xynSYvOyuLerg57mP7CXohs3F+VVcP8b9K/0=";
+};
+
+key "nsupdate.key" {
+    algorithm hmac-sha256;
+    secret "/qyKZnlxy1bL2QPS7JJRWVyc4apKNJVaWU7Xgxve7vk=";
+};
+
 options {
-	directory "/var/cache/bind";
+  directory "/var/cache/bind";
+  allow-query {dns_allowed_networks;};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+  forwarders {
+      1.1.1.1;
+      8.8.8.8;
+      9.9.9.9;
+     };
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+  forward first;
+  dnssec-validation no;
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
 };

changed: [orinocoz-3] => (item=options)
--- before: /etc/bind/named.conf.options
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpnpe9lr48/named.conf.options.j2
@@ -1,24 +1,33 @@
+acl dns_allowed_networks{
+        192.168.42.0/23;
+        127.0.0.0/8;
+        172.17.0.0/16;
+    };
+
+key "transfer.key" {
+    algorithm hmac-sha256;
+    secret "v8eL3F3xynSYvOyuLerg57mP7CXohs3F+VVcP8b9K/0=";
+};
+
+key "nsupdate.key" {
+    algorithm hmac-sha256;
+    secret "/qyKZnlxy1bL2QPS7JJRWVyc4apKNJVaWU7Xgxve7vk=";
+};
+
 options {
-	directory "/var/cache/bind";
+  directory "/var/cache/bind";
+  allow-query {dns_allowed_networks;};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
+  forwarders {
+      1.1.1.1;
+      8.8.8.8;
+      9.9.9.9;
+     };
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+  forward first;
+  dnssec-validation no;
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+statistics-channels {
+  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
 };

changed: [orinocoz-2] => (item=options)
--- before: /etc/bind/named.conf.local
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpe89g5rsd/named.conf.local.j2
@@ -1,8 +1,12 @@
-//
-// Do any local configuration here
-//
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "acme.ttu" {
+    type secondary;
+    file "db.acme.ttu";
+    primaries { 192.168.43.151 key "transfer.key"; };
+};
 
+zone "168.192.in-addr.arpa" {
+    type secondary;
+    file "db.168.192";
+    primaries { 192.168.43.151 key "transfer.key"; };
+};

--- before: /etc/bind/named.conf.local
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp_o9j3o_g/named.conf.local.j2
@@ -1,8 +1,14 @@
-//
-// Do any local configuration here
-//
+zone "acme.ttu" {
+    type primary;
+    file "db.acme.ttu";
+    allow-transfer { 127.0.0.1; key "transfer.key"; };
+    allow-update { key "nsupdate.key"; };
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "168.192.in-addr.arpa" {
+    type primary;
+    file "db.168.192";
+    allow-transfer { 127.0.0.1; key "transfer.key"; };
+    allow-update { key "nsupdate.key"; };
+};
 

changed: [orinocoz-1] => (item=local)
changed: [orinocoz-3] => (item=local)
--- before: /etc/bind/named.conf.local
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp7la90tqj/named.conf.local.j2
@@ -1,8 +1,12 @@
-//
-// Do any local configuration here
-//
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
+zone "acme.ttu" {
+    type secondary;
+    file "db.acme.ttu";
+    primaries { 192.168.43.151 key "transfer.key"; };
+};
 
+zone "168.192.in-addr.arpa" {
+    type secondary;
+    file "db.168.192";
+    primaries { 192.168.43.151 key "transfer.key"; };
+};

changed: [orinocoz-2] => (item=local)

TASK [bind : Configure master zone] ********************************************
skipping: [orinocoz-1]
skipping: [orinocoz-2]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp41an8w5h/db.master.j2
@@ -0,0 +1,17 @@
+$TTL 86400
+@   IN  SOA ns-1.acme.ttu. hostmaster.acme.ttu. (
+            1765534214   ; Serial generated once and updated by nsupdate
+       604800   ; Refresh
+        86400   ; Retry
+      2419200   ; Expire
+       604800 ) ; Negative Cache TTL
+;
+; NS records - one per DNS server
+@       IN  NS  orinocoz-3.acme.ttu.
+@       IN  NS  orinocoz-1.acme.ttu.
+@       IN  NS  orinocoz-2.acme.ttu.
+
+; A records for NS servers only
+orinocoz-3    IN  A   192.168.43.151
+orinocoz-1    IN  A   192.168.43.212
+orinocoz-2    IN  A   192.168.43.67

changed: [orinocoz-3]

TASK [bind : Configure reverse zone] *******************************************
skipping: [orinocoz-1]
skipping: [orinocoz-2]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp_4ak319m/db.reverse.j2
@@ -0,0 +1,12 @@
+$TTL 86400
+@   IN  SOA ns-1.acme.ttu. admin.acme.ttu. (
+            1765534214   ; Serial
+       604800   ; Refresh
+        86400   ; Retry
+      2419200   ; Expire
+       604800 ) ; Negative Cache TTL
+;
+; NS records
+@       IN  NS  orinocoz-3.acme.ttu.
+@       IN  NS  orinocoz-1.acme.ttu.
+@       IN  NS  orinocoz-2.acme.ttu.

changed: [orinocoz-3]

TASK [bind : Install Bind exporter] ********************************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-2]

TASK [bind : Create systemd service file for prometheus-bind-exporter] *********
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmplnoy6djv/bind_exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Prometheus exporter for Bind
+Documentation=https://github.com/digital_ocean/bind_exporter
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [orinocoz-1]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpqgecvvuv/bind_exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Prometheus exporter for Bind
+Documentation=https://github.com/digital_ocean/bind_exporter
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [orinocoz-3]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmphppkmtb3/bind_exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Prometheus exporter for Bind
+Documentation=https://github.com/digital_ocean/bind_exporter
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [orinocoz-2]

TASK [bind : Ensure Bind exporter is running and enabled] **********************
ok: [orinocoz-1]
ok: [orinocoz-3]
ok: [orinocoz-2]

TASK [bind : Flush handlers to ensure BIND has latest config] ******************

TASK [bind : Flush handlers to ensure BIND has latest config] ******************

TASK [bind : Flush handlers to ensure BIND has latest config] ******************

RUNNING HANDLER [bind : Restart bind] ******************************************
changed: [orinocoz-1]
changed: [orinocoz-3]
changed: [orinocoz-2]

RUNNING HANDLER [bind : Reload rndc] *******************************************
changed: [orinocoz-3]

RUNNING HANDLER [bind : Reload systemd] ****************************************
ok: [orinocoz-1]
ok: [orinocoz-3]
ok: [orinocoz-2]

TASK [bind : Add A records for all hosts] **************************************
changed: [orinocoz-3] => (item=orinocoz-3)
changed: [orinocoz-3] => (item=orinocoz-1)
changed: [orinocoz-3] => (item=orinocoz-2)

TASK [bind : Add backup server A record] ***************************************
changed: [orinocoz-3]

TASK [bind : Add NS CNAME records] *********************************************
changed: [orinocoz-3] => (item=orinocoz-3)
changed: [orinocoz-3] => (item=orinocoz-1)
changed: [orinocoz-3] => (item=orinocoz-2)

TASK [bind : Add PTR records for all hosts] ************************************
changed: [orinocoz-3] => (item=orinocoz-3)
changed: [orinocoz-3] => (item=orinocoz-1)
changed: [orinocoz-3] => (item=orinocoz-2)

TASK [bind : Add PTR record for backup server] *********************************
changed: [orinocoz-3]

PLAY [DNS resolver] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-1]
ok: [orinocoz-3]
ok: [orinocoz-2]

TASK [resolve : Stop daemon systemd-resolved] **********************************
changed: [orinocoz-1]
changed: [orinocoz-3]
changed: [orinocoz-2]

TASK [resolve : Change DNS configuration file] *********************************
--- before: /etc/resolv.conf
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpe8tlf4vn/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.212
+nameserver 192.168.43.67
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search .
+search acme.ttu

changed: [orinocoz-1]
--- before: /etc/resolv.conf
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpagge7owy/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.212
+nameserver 192.168.43.67
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search .
+search acme.ttu

changed: [orinocoz-3]
--- before: /etc/resolv.conf
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp_mfkgpr_/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.212
+nameserver 192.168.43.67
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search .
+search acme.ttu

changed: [orinocoz-2]

PLAY [Database servers] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql : Install MySQL] ***************************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libio-compress-brotli-perl
  libbusiness-isbn-perl libregexp-ipv6-perl libwww-perl mailx tinyca
  python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server mysql-server-8.0
  mysql-server-core-8.0 python3-pymysql
0 upgraded, 28 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-1]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libio-compress-brotli-perl
  libbusiness-isbn-perl libregexp-ipv6-perl libwww-perl mailx tinyca
  python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server mysql-server-8.0
  mysql-server-core-8.0 python3-pymysql
0 upgraded, 28 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-2]

TASK [mysql : Override MySQL bind address] *************************************
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp_tu1tilo/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 468

changed: [orinocoz-1]
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp6t2sry7u/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 323

changed: [orinocoz-2]

TASK [mysql : Ensure MySQL is started and enabled] *****************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql : MySQL database] **************************************************
changed: [orinocoz-2]
changed: [orinocoz-1]

TASK [mysql : Create MySQL user] ***********************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Install MySQL Exporter] ******************************************
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-1]
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-2]

TASK [mysql : MySQL Exporter user] *********************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Enable mysqld_exporter config path] ******************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : MySQL Exporter user conf] ****************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Force mysql exporter restart] ************************************

TASK [mysql : Force mysql exporter restart] ************************************

RUNNING HANDLER [mysql : Restart MySQL] ****************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

RUNNING HANDLER [mysql : Restart MySQL Exporter] *******************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : MySQL Exporter service] ******************************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql : Create /home/backup/mysql directory] *****************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0700",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-1]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0700",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-2]

TASK [mysql : Ensure MySQL backup user exist] **********************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Create backup template] ******************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Ensure MySQL backup user exist] **********************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql : Create backup template] ******************************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql : Create MySQL backup cron service] ********************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : MySQL replication user] ******************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql : Add DB CNAME records] ********************************************
changed: [orinocoz-1 -> orinocoz-3(193.40.157.25)] => (item=orinocoz-1)
changed: [orinocoz-1 -> orinocoz-3(193.40.157.25)] => (item=orinocoz-2)

RUNNING HANDLER [mysql : Restart MySQL cron] ***********************************
changed: [orinocoz-1]
changed: [orinocoz-2]

PLAY [MySQL replication] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql_replication : Get replica status] **********************************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [mysql_replication : Set read_only OFF on source] *************************
skipping: [orinocoz-2]
changed: [orinocoz-1]

TASK [mysql_replication : Stop replica on source (if running)] *****************
skipping: [orinocoz-1]
skipping: [orinocoz-2]

TASK [mysql_replication : Reset replica config on source] **********************
skipping: [orinocoz-1]
skipping: [orinocoz-2]

TASK [mysql_replication : Set read_only ON on replica] *************************
skipping: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql_replication : Stop replica before reconfiguring] *******************
skipping: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql_replication : Configure replica to connect to source] **************
skipping: [orinocoz-1]
changed: [orinocoz-2]

TASK [mysql_replication : Start replica on replica server] *********************
skipping: [orinocoz-1]
changed: [orinocoz-2]

PLAY [Web servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-2]
ok: [orinocoz-1]

TASK [docker : Install Docker packages] ****************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-2]

TASK [docker : Ensure Docker service is running and enabled] *******************
ok: [orinocoz-1]
ok: [orinocoz-2]

TASK [docker : Install Loki Docker logging driver] *****************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [agama : Create Agama build directory] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-2]

TASK [agama : Download Agama application] **************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [agama : Download Agama Dockerfile] ***************************************
changed: [orinocoz-1]
changed: [orinocoz-2]

TASK [agama : Build Agama Docker image] ****************************************
changed: [orinocoz-2]
changed: [orinocoz-1]

TASK [agama : Run Agama containers] ********************************************
changed: [orinocoz-2] => (item=None)
changed: [orinocoz-1] => (item=None)
changed: [orinocoz-2] => (item=None)
changed: [orinocoz-2]
changed: [orinocoz-1] => (item=None)
changed: [orinocoz-1]

TASK [agama : Add web CNAME records] *******************************************
changed: [orinocoz-1 -> orinocoz-3(193.40.157.25)] => (item=orinocoz-1)
changed: [orinocoz-1 -> orinocoz-3(193.40.157.25)] => (item=orinocoz-2)

PLAY [Prometheus server] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-3]

TASK [nginx : Install Nginx 1.24.0] ********************************************
The following additional packages will be installed:
  nginx-common
Suggested packages:
  fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  nginx nginx-common
0 upgraded, 2 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]

TASK [nginx : Copy nginx uWSGI config] *****************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp99fnn6gb/default.j2
@@ -1,91 +1,25 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
+	server_name _;
+		    location /prometheus {
+        proxy_pass http://localhost:9090;
+    }
+			location = / {
+  		return 404 ;
+	}
+	
+                location /grafana {
+                proxy_pass http://localhost:3001;
+                proxy_set_header Host $http_host;
+        }
+        }
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+server {
+    listen 8080 default_server;
+    
+    location /stub_status {
+        stub_status;
+        allow 127.0.0.1;
+        deny all;
+    }
 }
-
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}

changed: [orinocoz-3]

TASK [nginx : Ensure Nginx service is started and enabled] *********************
ok: [orinocoz-3]

TASK [nginx : Install from APT prometheus-nginx-exporter] **********************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]

TASK [nginx : Start Ngnix exporter service] ************************************
ok: [orinocoz-3]

TASK [prometheus : Install Prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
  prometheus
0 upgraded, 16 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]

TASK [prometheus : Make sure Prometheus is enabled and running] ****************
ok: [orinocoz-3]

TASK [prometheus : Run Prometheus config template] *****************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpwyvhz4lg/config.yaml.j2
@@ -1,44 +1,69 @@
-# Sample config for Prometheus.
+global:
+  scrape_interval: 5s
+  evaluation_interval: 5s
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
-alerting:
-  alertmanagers:
-  - static_configs:
-    - targets: ['localhost:9093']
-
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
+  - job_name: 'linux'
+    static_configs:
+      - targets:
+                - orinocoz-3:9100
+                - orinocoz-1:9100
+                - orinocoz-2:9100
+        
   - job_name: 'prometheus'
-
-    # Override the global default and scrape targets from this job every 5 seconds.
     scrape_interval: 5s
     scrape_timeout: 5s
-
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
+    metrics_path: '/prometheus/metrics'
     static_configs:
       - targets: ['localhost:9090']
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  - job_name: "mysql"
     static_configs:
-      - targets: ['localhost:9100']
+      - targets:
+        - orinocoz-1:9104
+        - orinocoz-2:9104
+
+  - job_name: "bind9"
+    static_configs:
+      - targets:
+          - orinocoz-3:9119
+          - orinocoz-1:9119
+          - orinocoz-2:9119
+
+  - job_name: "nginx"
+    static_configs:
+      - targets:
+        - orinocoz-3:9113
+        - orinocoz-1:9113
+        - orinocoz-2:9113
+
+  - job_name: "backup"
+    static_configs:
+      - targets:
+        - backup.acme.ttu:9111
+
+  - job_name: haproxy
+    static_configs:
+      - targets:
+          - orinocoz-1:9101
+      - targets:
+          - orinocoz-2:9101
+
+  - job_name: keepalived
+    static_configs:
+      - targets:
+          - orinocoz-1:9165
+      - targets:
+          - orinocoz-2:9165
+
+  - job_name: loki
+    static_configs:
+      - targets:
+          - orinocoz-3:3100
+
+  - job_name: promtail
+    static_configs:
+      - targets:
+          - orinocoz-1:9080
+          - orinocoz-2:9080
+          - orinocoz-3:9080

changed: [orinocoz-3]

TASK [prometheus : Run Prometheus Web External Template] ***********************
--- before: /etc/default/prometheus
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp8eht3q_f/metric.yaml.j2
@@ -1,5 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell escaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--web.external-url=http://orinocoz-3/prometheus --web.route-prefix=/prometheus --web.enable-admin-api --storage.tsdb.path=/var/lib/prometheus/metrics2"

changed: [orinocoz-3]

TASK [prometheus : Create Prometheus backup cron service] **********************
changed: [orinocoz-3]

TASK [prometheus : Add Prometheus CNAME record] ********************************
changed: [orinocoz-3]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [orinocoz-3]

RUNNING HANDLER [prometheus : Restart Prometheus] ******************************
changed: [orinocoz-3]

RUNNING HANDLER [prometheus : Restart Prometheus cron] *************************
changed: [orinocoz-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [orinocoz-3]

TASK [docker : Install Docker packages] ****************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 246 not upgraded.
changed: [orinocoz-3]

TASK [docker : Ensure Docker service is running and enabled] *******************
ok: [orinocoz-3]

TASK [docker : Install Loki Docker logging driver] *****************************
changed: [orinocoz-3]

TASK [nginx : Install Nginx 1.24.0] ********************************************
ok: [orinocoz-3]

TASK [nginx : Copy nginx uWSGI config] *****************************************
ok: [orinocoz-3]

TASK [nginx : Ensure Nginx service is started and enabled] *********************
ok: [orinocoz-3]

TASK [nginx : Install from APT prometheus-nginx-exporter] **********************
ok: [orinocoz-3]

TASK [nginx : Start Ngnix exporter service] ************************************
ok: [orinocoz-3]

TASK [grafana : Create Grafana config directories] *****************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3] => (item=/opt/grafana)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3] => (item=/opt/grafana/provisioning)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3] => (item=/opt/grafana/provisioning/dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [orinocoz-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Deploy grafana.ini] ********************************************
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpfohrp150/grafana.ini.j2
@@ -0,0 +1,16 @@
+[server]
+root_url = http://193.40.157.25:40780/grafana
+serve_from_sub_path = true
+
+[security]
+admin_user = orinocoz
+admin_password = grafanaadmin
+
+[dashboards]
+default_home_dashboard_path = /etc/grafana/provisioning/dashboards/main.json
+
+[auth.anonymous]
+enabled = true
+org_name = Main Org.
+org_role = Viewer
+

changed: [orinocoz-3]

TASK [grafana : Deploy datasource configuration] *******************************
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmp73ukiuuu/datasource.yaml.j2
@@ -0,0 +1,19 @@
+apiVersion: 1
+datasources:
+  - name: Prometheus
+    type: prometheus
+    uid: prometheus
+    access: proxy
+    orgId: 1
+    url: http://prometheus.acme.ttu:9090/prometheus
+    isDefault: true
+    version: 1
+    editable: false
+  - name: Loki1
+    type: loki
+    access: proxy
+    orgId: 1
+    uid: LOKI-BAAS
+    url: http://orinocoz-3:3100
+    isDefault: false
+    editable: true

changed: [orinocoz-3]

TASK [grafana : Deploy dashboard provisioning config] **************************
--- before
+++ after: /home/doc/.ansible/tmp/ansible-local-18308656quq131p/tmpegljsxp0/dashboards.yaml.j2
@@ -0,0 +1,11 @@
+apiVersion: 1
+
+providers:
+ - name: 'default'
+   orgId: 1
+   folder: ''
+   folderUid: ''
+   type: file
+   options:
+     path: /etc/grafana/provisioning/dashboards
+

changed: [orinocoz-3]

TASK [grafana : Deploy dashboard JSON files] ***********************************
--- before
+++ after: /home/doc/ica0002/roles/grafana/files/agama.json
@@ -0,0 +1,147 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 2493910408450048,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "LOKI-BAAS"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "custom": {
+            "displayMode": "json"
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 20,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 1,
+      "options": {
+        "dedupStrategy": "none",
+        "enableInfiniteScrolling": true,
+        "enableLogDetails": true,
+        "prettifyLogMessage": false,
+        "showCommonLabels": false,
+        "showLabels": true,
+        "showTime": true,
+        "sortOrder": "Descending",
+        "wrapLogMessage": false,
+        "fontSize": "10px"
+      },
+      "pluginVersion": "12.2.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "LOKI-BAAS"
+          },
+          "direction": "backward",
+          "editorMode": "code",
+          "expr": "{service_name=~\"agama.*\", container_name=~\"$container\", host=~\"$host\"}",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "Agama Logs",
+      "type": "logs"
+    }
+  ],
+  "preload": false,
+  "refresh": "1s",
+  "schemaVersion": 42,
+  "tags": ["agama", "loki"],
+  "templating": {
+    "list": [
+      {
+        "current": {
+          "selected": true,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "loki",
+          "uid": "LOKI-BAAS"
+        },
+        "definition": "",
+        "includeAll": true,
+        "label": "Container",
+        "multi": true,
+        "name": "container",
+        "options": [],
+        "query": {
+          "label": "container_name",
+          "refId": "LokiVariableQueryEditor-VariableQuery",
+          "stream": "{service_name=~\"agama.*\"}",
+          "type": 1
+        },
+        "refresh": 1,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "type": "query"
+      },
+      {
+        "current": {
+          "selected": true,
+          "text": "All",
+          "value": "$__all"
+        },
+        "datasource": {
+          "type": "loki",
+          "uid": "LOKI-BAAS"
+        },
+        "definition": "",
+        "includeAll": true,
+        "label": "Host",
+        "multi": true,
+        "name": "host",
+        "options": [],
+        "query": {
+          "label": "host",
+          "refId": "LokiVariableQueryEditor-VariableQuery",
+          "stream": "{service_name=~\"agama.*\"}",
+          "type": 1
+        },
+        "refresh": 1,
+        "regex": "",
+        "skipUrlSync": false,
+        "sort": 1,
+        "type": "query"
+      }
+    ]
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Agama",
+  "uid": "bimqc9r",
+  "version": 1
+}

changed: [orinocoz-3] => (item=agama.json)
--- before
+++ after: /home/doc/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1543 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 1,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "LOKI-BAAS"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 100,
+            "axisSoftMin": 95,
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "dashed+area"
+            }
+          },
+          "mappings": [],
+          "noValue": "0",
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 98
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 11,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "LOKI-BAAS"
+          },
+          "editorMode": "code",
+          "expr": "100 * sum(count_over_time({job=\"haproxy\"} |~ \"^[23]\"[15m])) / sum(count_over_time({job=\"haproxy\"} |~ \"^[235]\"[15m]))",
+          "legendFormat": "Uptime %",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "SLI: Uptime (%)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "LOKI-BAAS"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "axisSoftMax": 150,
+            "axisSoftMin": 0,
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "dashed+area"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 100
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 12,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "LOKI-BAAS"
+          },
+          "editorMode": "code",
+          "expr": "avg_over_time({job=\"haproxy\"} | regexp \"^[2-3][0-9]{2} (?P<latency>[0-9.]+)\" | unwrap latency [15m])",
+          "legendFormat": "Latency ms",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "SLI: Latency (ms)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 2,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Memory Consumption (%)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 12,
+        "x": 12,
+        "y": 8
+      },
+      "id": 1,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "100 * (1 - rate(node_cpu_seconds_total{mode=\"idle\"}[1m]))",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "CPU Utilization (%)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 15
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "bind_up",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 6,
+        "y": 15
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "nginx_up",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 12,
+        "y": 15
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "mysql_up",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "noValue": "0"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 18,
+        "y": 15
+      },
+      "id": 13,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "haproxy_up",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "HAProxy",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "noValue": "0"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 20
+      },
+      "id": 14,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "keepalived_up",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Keepalived",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 0,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "light-green",
+                  "index": 1,
+                  "text": "STAND-BY"
+                },
+                "2": {
+                  "color": "dark-green",
+                  "index": 2,
+                  "text": "ACTIVE"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          },
+          "noValue": "0"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 6,
+        "y": 20
+      },
+      "id": 15,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "keepalived_vrrp_state",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Keepalived VRRP",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          },
+          "noValue": "0"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 12,
+        "x": 12,
+        "y": 20
+      },
+      "id": 16,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "haproxy_server_up",
+          "instant": false,
+          "legendFormat": "{{server}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "HAProxy Servers",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 0,
+        "y": 25
+      },
+      "id": 6,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m])",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "DNS (A queries/min)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 8,
+        "y": 25
+      },
+      "id": 8,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(nginx_http_requests_total[1m])",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx (requests/min)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 8,
+        "x": 16,
+        "y": 25
+      },
+      "id": 7,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL (SELECT/min)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 12,
+        "x": 0,
+        "y": 32
+      },
+      "id": 17,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "sum by (level) (rate(loki_log_messages_total[1m]))",
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Loki (logs/min)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 12,
+        "x": 12,
+        "y": 32
+      },
+      "id": 18,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(promtail_sent_entries_total[1m])",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Promtail (logs/min)",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "default": true,
+        "type": "prometheus"
+      },
+      "description": "Zone serial numbers should match between primary and secondary DNS servers",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 24,
+        "x": 0,
+        "y": 39
+      },
+      "id": 9,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "horizontal",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "bind_zone_serial{zone_name=\"acme.ttu\"}",
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "DNS Zone Serial",
+      "type": "stat"
+    }
+  ],
+  "refresh": "1s",
+  "schemaVersion": 39,
+  "tags": ["main", "overview"],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Main",
+  "uid": "t2g2h2j2-k222-m2n2-o2p2-q2r2s2t2u2v2",
+  "version": 6,
+  "weekStart": ""
+}

changed: [orinocoz-3] => (item=main.json)
--- before
+++ after: /home/doc/ica0002/roles/grafana/files/backups.json
@@ -0,0 +1,425 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 69,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "red", "value": null},
+              {"color": "yellow", "value": 60},
+              {"color": "green", "value": 360}
+            ]
+          },
+          "unit": "m",
+          "min": 0,
+          "max": 1440,
+          "decimals": 0
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 7, "w": 8, "x": 0, "y": 0 },
+      "id": 13,
+      "options": {
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "targets": [
+        {
+          "expr": "clamp_min((1440 - (time() - backup_last_success_time{user=\"orinocoz\", service=\"mysql\"}) / 60), 0)",
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL - Time Until Next Backup",
+      "type": "gauge"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "red", "value": null},
+              {"color": "yellow", "value": 60},
+              {"color": "green", "value": 360}
+            ]
+          },
+          "unit": "m",
+          "min": 0,
+          "max": 1440,
+          "decimals": 0
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 7, "w": 8, "x": 8, "y": 0 },
+      "id": 14,
+      "options": {
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "targets": [
+        {
+          "expr": "clamp_min((1440 - (time() - backup_last_success_time{user=\"orinocoz\", service=\"prometheus\"}) / 60), 0)",
+          "refId": "A"
+        }
+      ],
+      "title": "Prometheus - Time Until Next Backup",
+      "type": "gauge"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "red", "value": null},
+              {"color": "yellow", "value": 60},
+              {"color": "green", "value": 360}
+            ]
+          },
+          "unit": "m",
+          "min": 0,
+          "max": 1440,
+          "decimals": 0
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 7, "w": 8, "x": 16, "y": 0 },
+      "id": 15,
+      "options": {
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "showThresholdLabels": false,
+        "showThresholdMarkers": true
+      },
+      "targets": [
+        {
+          "expr": "clamp_min((1440 - (time() - backup_last_success_time{user=\"orinocoz\", service=\"loki\"}) / 60), 0)",
+          "refId": "A"
+        }
+      ],
+      "title": "Loki - Time Until Next Backup",
+      "type": "gauge"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          },
+          "unit": "time:YYYY-MM-DD HH:mm"
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 4, "w": 8, "x": 0, "y": 7 },
+      "id": 10,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backup_last_success_time{user=\"orinocoz\", service=\"mysql\"} * 1000",
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL - Last Backup",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          },
+          "unit": "time:YYYY-MM-DD HH:mm"
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 4, "w": 8, "x": 8, "y": 7 },
+      "id": 11,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backup_last_success_time{user=\"orinocoz\", service=\"prometheus\"} * 1000",
+          "refId": "A"
+        }
+      ],
+      "title": "Prometheus - Last Backup",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "thresholds"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          },
+          "unit": "time:YYYY-MM-DD HH:mm"
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 4, "w": 8, "x": 16, "y": 7 },
+      "id": 12,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backup_last_success_time{user=\"orinocoz\", service=\"loki\"} * 1000",
+          "refId": "A"
+        }
+      ],
+      "title": "Loki - Last Backup",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "palette-classic"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 5, "w": 8, "x": 0, "y": 11 },
+      "id": 6,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backups_total{user=\"orinocoz\", service=\"mysql\"}",
+          "legendFormat": "{{type}}",
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Backup Counts",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "palette-classic"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 5, "w": 8, "x": 8, "y": 11 },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backups_total{user=\"orinocoz\", service=\"prometheus\"}",
+          "legendFormat": "{{type}}",
+          "refId": "A"
+        }
+      ],
+      "title": "Prometheus Backup Counts",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {"mode": "palette-classic"},
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {"color": "green", "value": null}
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": { "h": 5, "w": 8, "x": 16, "y": 11 },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": ["lastNotNull"],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "targets": [
+        {
+          "expr": "backups_total{user=\"orinocoz\", service=\"loki\"}",
+          "legendFormat": "{{type}}",
+          "refId": "A"
+        }
+      ],
+      "title": "Loki Backup Counts",
+      "type": "stat"
+    }
+  ],
+  "refresh": "1s",
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": ["backups"],
+  "templating": { "list": [] },
+  "time": { "from": "now-6h", "to": "now" },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Backups",
+  "uid": "dc327_n4k",
+  "version": 2,
+  "weekStart": ""
+}

changed: [orinocoz-3] => (item=backups.json)
--- before
+++ after: /home/doc/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,549 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 3,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_up",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Server Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "orange",
+                  "index": 1,
+                  "text": "Disabled"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "Running"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 6,
+        "y": 0
+      },
+      "id": 6,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_sql_running",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Slave SQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "orange",
+                  "index": 1,
+                  "text": "Disabled"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "Enabled"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 12,
+        "y": 0
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_io_running",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Slave IO Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "green",
+                  "index": 1,
+                  "text": "Write Enabled"
+                },
+                "1": {
+                  "color": "orange",
+                  "index": 0,
+                  "text": "Read Only"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 18,
+        "y": 0
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Read Only Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 5
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_global_variables_server_id",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Server ID",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 10,
+        "w": 18,
+        "x": 6,
+        "y": 5
+      },
+      "id": 1,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[5m])",
+          "legendFormat": "{{instance}} : {{command}}",
+          "range": true,
+          "refId": "A"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"insert\"}[5m])",
+          "hide": false,
+          "instant": false,
+          "legendFormat": "{{instance}} : {{command}}",
+          "range": true,
+          "refId": "B"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"update\"}[5m])",
+          "hide": false,
+          "instant": false,
+          "legendFormat": "{{instance}} : {{command}}",
+          "range": true,
+          "refId": "C"
+        }
+      ],
+      "title": "MySQL Commands Rate",
+      "type": "timeseries"
+    }
+  ],
+  "preload": false,
+  "refresh": "1s",
+  "schemaVersion": 42,
+  "tags": ["mysql"],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "MySQL stats",
+  "uid": "mysql-dashboard-uid-001",
+  "version": 4
+}

changed: [orinocoz-3] => (item=mysql.json)
--- before
+++ after: /home/doc/ica0002/roles/grafana/files/haproxy.json
@@ -0,0 +1,147 @@
+{
+  "annotations": {"list": []},
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": null,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "DOWN"}}, "type": "value"},
+            {"options": {"1": {"color": "green", "text": "UP"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
+      "id": 1,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "haproxy_up{instance=~\"orinocoz-1.*\"}", "legendFormat": "orinocoz-1"}],
+      "title": "HAProxy UP - orinocoz-1",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "DOWN"}}, "type": "value"},
+            {"options": {"1": {"color": "green", "text": "UP"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
+      "id": 2,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "haproxy_up{instance=~\"orinocoz-2.*\"}", "legendFormat": "orinocoz-2"}],
+      "title": "HAProxy UP - orinocoz-2",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "DOWN"}}, "type": "value"},
+            {"options": {"1": {"color": "green", "text": "UP"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
+      "id": 3,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "keepalived_up{instance=~\"orinocoz-1.*\"}", "legendFormat": "orinocoz-1"}],
+      "title": "Keepalived UP - orinocoz-1",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "DOWN"}}, "type": "value"},
+            {"options": {"1": {"color": "green", "text": "UP"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
+      "id": 4,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "keepalived_up{instance=~\"orinocoz-2.*\"}", "legendFormat": "orinocoz-2"}],
+      "title": "Keepalived UP - orinocoz-2",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "INIT"}}, "type": "value"},
+            {"options": {"1": {"color": "orange", "text": "BACKUP"}}, "type": "value"},
+            {"options": {"2": {"color": "green", "text": "MASTER"}}, "type": "value"},
+            {"options": {"3": {"color": "yellow", "text": "FAULT"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "orange", "value": 1}, {"color": "green", "value": 2}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 12, "x": 0, "y": 4},
+      "id": 5,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "keepalived_vrrp_state{instance=~\"orinocoz-1.*\"}", "legendFormat": "orinocoz-1"}],
+      "title": "Keepalived VRRP State - orinocoz-1",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "INIT"}}, "type": "value"},
+            {"options": {"1": {"color": "orange", "text": "BACKUP"}}, "type": "value"},
+            {"options": {"2": {"color": "green", "text": "MASTER"}}, "type": "value"},
+            {"options": {"3": {"color": "yellow", "text": "FAULT"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "orange", "value": 1}, {"color": "green", "value": 2}]}
+        }
+      },
+      "gridPos": {"h": 4, "w": 12, "x": 12, "y": 4},
+      "id": 6,
+      "options": {"colorMode": "value", "graphMode": "none"},
+      "targets": [{"expr": "keepalived_vrrp_state{instance=~\"orinocoz-2.*\"}", "legendFormat": "orinocoz-2"}],
+      "title": "Keepalived VRRP State - orinocoz-2",
+      "type": "stat"
+    },
+    {
+      "datasource": {"type": "prometheus", "uid": "prometheus"},
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {"options": {"0": {"color": "red", "text": "DOWN"}}, "type": "value"},
+            {"options": {"1": {"color": "green", "text": "UP"}}, "type": "value"}
+          ],
+          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}
+        }
+      },
+      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8},
+      "id": 7,
+      "options": {"colorMode": "value", "graphMode": "none", "orientation": "horizontal"},
+      "targets": [{"expr": "haproxy_server_up", "legendFormat": "{{server}}"}],
+      "title": "HAProxy Backend Servers Status",
+      "type": "stat"
+    }
+  ],
+  "refresh": "1s",
+  "schemaVersion": 38,
+  "tags": ["haproxy", "keepalived"],
+  "time": {"from": "now-5m", "to": "now"},
+  "title": "HAProxy & Keepalived",
+  "uid": "haproxy-keepalived",
+  "version": 1
+}

changed: [orinocoz-3] => (item=haproxy.json)

TASK [grafana : Run Grafana container] *****************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [orinocoz-3]

TASK [grafana : Add Grafana CNAME record] **************************************
changed: [orinocoz-3]

RUNNING HANDLER [grafana : Restart Grafana container] **************************
fatal: [orinocoz-3]: FAILED! => {"changed": false, "msg": "Error restarting container 261248e25f25a2b8b032eacc4012780f0e52d24669d56c0aa5a3316220e31fff: UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)"}

PLAY RECAP *********************************************************************
orinocoz-1                 : ok=67   changed=47   unreachable=0    failed=0    skipped=8    rescued=0    ignored=0   
orinocoz-2                 : ok=68   changed=48   unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
orinocoz-3                 : ok=71   changed=49   unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

